# Exemplu configuraÈ›ie automatizÄƒri pentru Alerte Nowcasting
# Copie Ã®n configuration.yaml sau Ã®n automations.yaml

automation:
  # Notificare cÃ¢nd Ã®ncepe o alertÄƒ meteo
  - id: alerta_nowcasting_start
    alias: "Alerta Meteo - Ãnceput"
    description: "Notificare cÃ¢nd Ã®ncepe un fenomen meteo extrem"
    trigger:
      - platform: state
        entity_id: sensor.alerta_nowcasting
        # Trigger cÃ¢nd numÄƒrul de alerte active creÈ™te
    condition:
      - condition: template
        value_template: "{{ trigger.to_state.state | int > trigger.from_state.state | int }}"
      - condition: template
        value_template: "{{ trigger.to_state.state | int > 0 }}"
    action:
      # Notificare mobilÄƒ
      - service: notify.mobile_app
        data:
          title: "ğŸŒ©ï¸ ALERTÄ‚ METEO"
          message: >
            {{ state_attr('sensor.alerta_nowcasting', 'alert_title') }}
            
            {% if state_attr('sensor.alerta_nowcasting', 'counties') %}
            JudeÈ›e: {{ state_attr('sensor.alerta_nowcasting', 'counties') | join(', ') }}
            {% endif %}
            
            {{ state_attr('sensor.alerta_nowcasting', 'alert_description') }}
          data:
            priority: high
            ttl: 0
            channel: Alerte Meteo
            color: "#ff5722"
            tag: weather_alert
            actions:
              - action: "VIEW_DETAILS"
                title: "Vezi detalii"
      
      # Notificare TTS (opÈ›ional - dacÄƒ ai Google Home sau Alexa)
      - service: tts.google_translate_say
        data:
          entity_id: media_player.living_room_speaker
          message: >
            AtenÈ›ie! AlertÄƒ meteo pentru {{ state_attr('sensor.alerta_nowcasting', 'counties') | join(', ') }}.
            {{ state_attr('sensor.alerta_nowcasting', 'phenomena') }}.
      
      # Aprinde LED-uri Ã®n roÈ™u (opÈ›ional - dacÄƒ ai lumini smart)
      - service: light.turn_on
        target:
          entity_id: light.living_room
        data:
          brightness: 255
          rgb_color: [255, 0, 0]
          flash: long

  # Notificare cÃ¢nd se terminÄƒ o alertÄƒ meteo
  - id: alerta_nowcasting_end
    alias: "Alerta Meteo - SfÃ¢rÈ™it"
    description: "Notificare cÃ¢nd se terminÄƒ un fenomen meteo extrem"
    trigger:
      - platform: state
        entity_id: sensor.alerta_nowcasting
        to: "0"
    condition:
      - condition: template
        value_template: "{{ trigger.from_state.state | int > 0 }}"
    action:
      - service: notify.mobile_app
        data:
          title: "âœ… AlertÄƒ meteo Ã®ncheiatÄƒ"
          message: "Fenomenul meteo extrem s-a Ã®ncheiat. ReveniÈ›i la activitÄƒÈ›ile normale."
          data:
            priority: normal
            channel: Alerte Meteo
            color: "#4caf50"
            tag: weather_alert
      
      # RestabileÈ™te luminile normale (opÈ›ional)
      - service: light.turn_on
        target:
          entity_id: light.living_room
        data:
          brightness: 180
          kelvin: 3500

  # Notificare de actualizare periodicÄƒ dacÄƒ alerta este Ã®n curs (opÈ›ional)
  - id: alerta_nowcasting_reminder
    alias: "Alerta Meteo - Reminder periodic"
    description: "Reminder la fiecare 30 minute cÃ¢t dureazÄƒ alerta"
    trigger:
      - platform: time_pattern
        minutes: "/30"
    condition:
      - condition: numeric_state
        entity_id: sensor.alerta_nowcasting
        above: 0
    action:
      - service: notify.mobile_app
        data:
          title: "âš ï¸ AlertÄƒ meteo Ã®n curs"
          message: >
            Alerta meteo este Ã®ncÄƒ activÄƒ.
            Fenomen: {{ state_attr('sensor.alerta_nowcasting', 'phenomena') }}
            SfÃ¢rÈ™it estimat: {{ state_attr('sensor.alerta_nowcasting', 'alert_end') | as_timestamp | timestamp_custom('%H:%M') }}
          data:
            priority: normal
            channel: Alerte Meteo
